```Detecting vm process enumeration, process kills, & reverse shells on ESXi```

index=syslog sourcetype=vmware_vcenter (log_file="*shell.log" OR log_file="*crond.log") 
| rex field=message "\d+-\d+-\d+T\d+:\d+:\d+Z\s(\w|\.)+\s\w+\[\d+\]:\s\[(?<user>(\w|\d)+)\]:\s(?<shell_Command>.*)$" 
| rex field=message "\d+-\d+-\d+T\d+:\d+:\d+Z\s(\w|\.)+\s\w+\[\d+\]:\s(?<esxicli_Command>.*$)" 
| eval command=mvappend(esxicli_Command, shell_Command)
| where isnotnull(command) 
| search (command IN ("esxcli vm process list >>*", "esxcli vm process kill -t=force -w", "*vm process list*", "*vm process kill*", "* esxcli vm process list >>*", "* esxcli vm process kill -t=force -w", "*bash -i >& /dev/tcp/*", "*/dev/tcp/*", "*/dev/udp/*", "*/socat exec:'bash -li'*", "*socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"))*", "*new IO::Socket::INET(PeerAddr*", "*python -c 'import socket*"))
| table hostname timeStamp user command


```Detecting SSH authentication brute force on ESXi```

index=syslog sourcetype=vmware_vcenter log_file="*/sshd.log"
| rex field=message "\d+-\d+-\d+T\d+:\d+:\d+Z\s(\w|\.)+\s\w+\[\d+\]:\spam_unix\(sshd:auth\):\s(?<auth_events>.*$)"
| rex field=message "\d+-\d+-\d+T\d+:\d+:\d+Z\s(\w|\.)+\s\w+\[\d+\]:\s(?<auth_debug>Failed\skeyboard.*$)" 
| search (auth_debug="Failed keyboard-interactive/pam for *") OR (auth_events="authentication failure; *")
| eval log_match_match = mvappend(auth_events, auth_debug)
| stats count values(log_match_match) as log_matches by hostname
| where count > 10
